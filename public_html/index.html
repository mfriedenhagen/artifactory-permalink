<!DOCTYPE html>
<html>
    <head>
        <title>My Search</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <!-- script type="text/javascript" src="js/bootstrap.js"></script-->
        <style type="text/css" src='css/bootstrap.css'></style>
        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript">
            function showRepositories() {
                $.getJSON("/artifactory/api/repositories?type=LOCAL",
                    function(data) {
                        var items = [];
                        $.each(data,
                            function(key, data) {
                                items.push('<option name="' + data.key + '">' + data.key + '</option>');
                            }
                        );

                        $(items.join('')).replaceAll('#repositories')
                    }
                );
            }
            function showArtifacts(repository, groupId, artifactId, version) {
                $.ajax(
                    {
                        url: "/artifactory/api/search/gavc?repos=" + repository + "&g=" + groupId + "&a=" + artifactId + "&v=" + version,
                        type: "GET",
                        dataType: "json",
                        error: function() {
                            alert("Error");
                        },
                        beforeSend: function(xhr) {
                            xhr.setRequestHeader("X-Result-Detail", "info");
                        },
                        success: function(data) {
                            var items = [];
                            items.push("<tr><th>URL</th><th>SHA1</th></tr>")
                            $.each(data.results,
                                function(key, val) {
                                    items.push(
                                        '<tr><td><a href="' + val.downloadUri + '">' + val.path + '</a></td>' +
                                        '<td>' + val.checksums.sha1 + '</td></tr>'
                                    );
                                }
                            );

                            $('<table/>', {
                                'id': 'results',
                                'class': 'my-new-list',
                                html: items.join('')
                            }).replaceAll('#results');
                        },
                    }
                );
            }
            function onFormSubmit() {

            }
            showRepositories();
        </script>
    </head>
    <body onload="showRepositories();">
        <h1>Search artifacts</h1>
        <div>
            <form id='search' action='#' method="GET">
                <table>
                    <tr>
                        <th>Repositories</th>
                        <td><select id="repositoryId">
                                <option id="repositories">
                            </select>
                        </td>
                    </tr>
                    <tr><th>GroupId</th><td><input type="text" id="groupId"></td></tr>
                    <tr><th>ArtifactId</th><td><input type="text" id="artifactId"></td></tr>
                    <tr><th>Version</th><td><input type="text" id="version"></td></tr>
                    <tr><th colspan="2"><input type="submit" id="Search"></th></tr>
                </table>
            </form>
        </div>
        <script>
            $('#search').submit(
                    function() {
                        showArtifacts($('#repositoryId').val(), $('#groupId').val(), $('#artifactId').val(), $('#version').val());
                        return true;
                    }
            );
        </script>
        <div>
            <table id='results'></table>
        </div>
    </body>
</html>
