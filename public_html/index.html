<!DOCTYPE html>
<html>
    <head>
        <title>My Search</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="js/bootstrap.js"></script>
        <link rel="stylesheet" type="text/css" href='css/bootstrap.css'>
        <script type="text/javascript">
            function initializeForm() {
                var repositoryId = getParameterByName('repositoryId');
                $.getJSON("/artifactory/api/repositories?type=LOCAL",
                    function(data) {
                        var items = [];
                        $.each(data,
                            function(key, data) {
                                if (data.key === repositoryId) {
                                    items.push('<option name="' + data.key + '" selected>' + data.key + '</option>');
                                } else {
                                    items.push('<option name="' + data.key + '">' + data.key + '</option>');
                                }
                            }
                        );

                        $(items.join('')).replaceAll('#repositories')
                    }
                );
                $('#groupId').val(getParameterByName('groupId'));
                $('#artifactId').val(getParameterByName('artifactId'));
                $('#version').val(getParameterByName('version'));
            }
            function showArtifacts(repository, groupId, artifactId, version) {
                $.ajax(
                    {
                        url: "/artifactory/api/search/gavc?repos=" + repository + "&g=" + groupId + "&a=" + artifactId + "&v=" + version,
                        type: "GET",
                        dataType: "json",
                        error: function() {
                            alert("Error");
                        },
                        beforeSend: function(xhr) {
                            xhr.setRequestHeader("X-Result-Detail", "info");
                        },
                        success: function(data) {
                            var items = [];
                            items.push("<tr><th>URL</th><th>SHA1</th></tr>")
                            $.each(data.results,
                                function(key, val) {
                                    items.push(
                                        '<tr><td><a href="' + val.downloadUri + '">' + val.path + '</a></td>' +
                                        '<td>' + val.checksums.sha1 + '</td></tr>'
                                    );
                                }
                            );

                            $('<table/>', {
                                'id': 'results',
                                'class': 'table-striped',
                                html: items.join('')
                            }).replaceAll('#results');
                        }
                    }
                );
            }
            function getParameterByName(name) {
                name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
                var regexS = "[\\?&]" + name + "=([^&#]*)";
                var regex = new RegExp(regexS);
                var results = regex.exec(window.location.search);
                if(results === null) {
                    return "";
                } else {
                  return decodeURIComponent(results[1].replace(/\+/g, " "));
                }
            }
        </script>
    </head>
    <body>
        <h1>Search artifacts</h1>
        <div>
            <form id='search' action='#' method="GET">
                <table class="table-striped">
                    <tr>
                        <th>Repositories</th>
                        <td><select id="repositoryId" name="repositoryId">
                                <option id="repositories">
                            </select>
                        </td>
                    </tr>
                    <tr><th>GroupId</th><td><input type="text" id="groupId" name="groupId"></td></tr>
                    <tr><th>ArtifactId</th><td><input type="text" id="artifactId" name="artifactId"></td></tr>
                    <tr><th>Version</th><td><input type="text" id="version" name="version"></td></tr>
                    <tr><th colspan="2"><input type="submit" id="Search"></th></tr>
                </table>
            </form>
        </div>
        <script>
            $('#search').submit(
                    function() {
                        showArtifacts($('#repositoryId').val(), $('#groupId').val(), $('#artifactId').val(), $('#version').val());
                        return true;
                    }
            );
            $(initializeForm());
        </script>
        <div>
            <table id='results' class="table-striped"></table>
        </div>
    </body>
</html>
